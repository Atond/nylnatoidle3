/**
 * 🛠️ SCRIPT D'IMPORT CORRIGÉ
 * 
 * PROBLÈME RÉSOLU:
 * L'événement 'beforeunload' sauvegardait le jeu actuel AVANT le rechargement,
 * écrasant ainsi l'import "Atond" avec "eaz".
 * 
 * SOLUTION:
 * 1. Désactive l'auto-save
 * 2. Marque le jeu comme "en cours de reset" pour bloquer beforeunload
 * 3. Écrit la nouvelle sauvegarde
 * 4. Force le rechargement sans sauvegarder
 */

// ⚠️ MÉTHODE 1 : COPIER-COLLER (LA PLUS SIMPLE)
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// 1. Ouvrez votre fichier JSON (nylnato-save-2025-10-13T21-06-12.json)
// 2. Copiez TOUT le contenu (Ctrl+A, Ctrl+C)
// 3. Remplacez la ligne 23 ci-dessous par : const saveData = <COLLEZ ICI>;
// 4. Exécutez ce script dans la console
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

// 1. Arrêter l'auto-save et bloquer beforeunload
if (window.game) {
    window.game.stopAutoSave();
    window.game.isResetting = true; // ✅ Bloque la sauvegarde dans beforeunload
    console.log('🛑 Auto-save désactivé');
}

// 2. ⚠️ COLLEZ VOTRE SAUVEGARDE ICI (remplacez null par le contenu JSON)
const saveData = {"version":"0.1.0-alpha","timestamp":1760389572317,"player":{"name":"Atond","gender":"female","class":"priest","isMainCharacter":true,"level":23,"xp":4246,"xpRequired":11030,"stats":{"hp":54975805613940,"maxHp":330,"force":49,"agility":27,"intelligence":27,"wisdom":30,"endurance":49},"equipment":{"weapon":null,"armor":null,"accessory":null},"resources":{"gold":47354,"wood":{"common":0,"oak":0,"pine":0},"ore":{"stone":0,"iron":0,"copper":0}},"isAlive":true},"combat":{"currentRegion":1,"currentZone":1,"monstersKilled":171,"bossKillsInRegion":3174,"unlockedRegions":1,"unlockedZones":{"1":10},"monstersKilledPerZone":{"1_1":420,"1_2":10,"1_3":10,"1_4":10,"1_5":10,"1_6":10,"1_7":10,"1_8":2676,"1_9":12,"1_10":6},"currentMonster":{"id":"loup_gris","level":1,"hp":25,"maxHp":25,"stats":{"hp":25,"attack":4,"defense":2,"speed":2500},"isAlive":true,"xpReward":14,"goldReward":5},"isActive":true,"isFighting":false,"autoCombatEnabled":false},"quests":{"quests":{"quest_first_steps":{"id":"quest_first_steps","progress":10,"isCompleted":true,"isActive":false},"quest_resource_master":{"id":"quest_resource_master","progress":50,"isCompleted":true,"isActive":false},"quest_builder":{"id":"quest_builder","progress":100,"isCompleted":true,"isActive":false},"quest_legendary_hero":{"id":"quest_legendary_hero","progress":200,"isCompleted":true,"isActive":false},"quest_woodcutter_apprentice":{"id":"quest_woodcutter_apprentice","progress":50,"isCompleted":true,"isActive":false},"quest_miner_apprentice":{"id":"quest_miner_apprentice","progress":50,"isCompleted":true,"isActive":false}}},"professions":{"professions":{"woodcutter":{"id":"woodcutter","level":12,"xp":2124,"targetResource":"wood_oak"},"miner":{"id":"miner","level":12,"xp":1084,"targetResource":"ore_iron"},"blacksmith":{"id":"blacksmith","level":1,"xp":30,"targetResource":null},"armorsmith":{"id":"armorsmith","level":4,"xp":245,"targetResource":null},"jeweler":{"id":"jeweler","level":1,"xp":0,"targetResource":null},"alchemy":{"id":"alchemy","level":1,"xp":60,"targetResource":null}},"inventory":[["wood_oak",1390],["gem_citrine",41],["ore_iron",1683],["gem_quartz",91],["gem_topaz",16],["gem_carnelian",70],["gem_amethyst",61],["gem_ruby",6],["gem_onyx",39],["gem_dragoncrystal",2],["gem_garnet",15],["gem_emerald",14],["gem_jade",27],["gem_alexandrite",1],["gem_spinel",5],["gem_aquamarine",3],["gem_sapphire",13],["gem_opal",6],["gem_tanzanite",1],["gem_voidstone",1],["gem_diamond",2],["gem_astraltears",2],["wood_maple",6]],"autoGatherState":{"woodcutter":{"enabled":true,"unlocked":true},"miner":{"enabled":true,"unlocked":true}}},"equipment":{"equipped":[{"slot":"weapon","equipment":{"id":"iron_sword_1760376475181","name":"Épée de Fer","type":"weapon","slot":"weapon","rarity":"common","quality":"exceptional","qualityMultiplier":1.5,"locked":false,"icon":"⚔️","stats":{"force":46727380,"agility":0,"intelligence":0,"wisdom":0,"endurance":0,"damage":86956822,"defense":0,"professionXP":0,"dropRate":0},"requiredLevel":1,"description":"Une simple épée en fer forgé."}},{"slot":"chest","equipment":{"id":"iron_chestplate_1760376573305","name":"Plastron de Fer","type":"armor","slot":"chest","rarity":"uncommon","quality":"perfect","qualityMultiplier":2,"locked":false,"icon":"👔","stats":{"force":2199023255552,"agility":0,"intelligence":0,"wisdom":0,"endurance":8796093022208,"damage":0,"defense":13194139533312,"professionXP":0,"dropRate":0},"requiredLevel":3,"description":"Un plastron solide en fer battu."}},{"slot":"legs","equipment":{"id":"leather_pants_1760376531570","name":"Pantalon de Cuir","type":"armor","slot":"legs","rarity":"common","quality":"exceptional","qualityMultiplier":1.5,"locked":false,"icon":"🦵","stats":{"force":0,"agility":17937985,"intelligence":0,"wisdom":0,"endurance":26906977,"damage":0,"defense":40360465,"professionXP":0,"dropRate":0},"requiredLevel":2,"description":"Un pantalon en cuir résistant."}},{"slot":"boots","equipment":{"id":"leather_boots_1760376535271","name":"Bottes de Cuir","type":"armor","slot":"boots","rarity":"common","quality":"perfect","qualityMultiplier":2,"locked":false,"icon":"👞","stats":{"force":0,"agility":5497558138880,"intelligence":0,"wisdom":0,"endurance":2199023255552,"damage":0,"defense":3298534883328,"professionXP":0,"dropRate":0},"requiredLevel":2,"description":"Des bottes légères pour se déplacer rapidement."}},{"slot":"gloves","equipment":{"id":"work_gloves_1760376555694","name":"Gants de Travail","type":"armor","slot":"gloves","rarity":"common","quality":"exceptional","qualityMultiplier":1.5,"locked":false,"icon":"🧤","stats":{"force":0,"agility":0,"intelligence":0,"wisdom":0,"endurance":0,"damage":0,"defense":0,"professionXP":46727380,"dropRate":26906977},"requiredLevel":1,"description":"Des gants robustes pour les métiers."}},{"slot":"helmet","equipment":{"id":"leather_helmet_1760376490963","name":"Capuche de Cuir","type":"armor","slot":"helmet","rarity":"common","quality":"exceptional","qualityMultiplier":1.5,"locked":false,"icon":"🎩","stats":{"force":0,"agility":0,"intelligence":0,"wisdom":0,"endurance":17937985,"damage":0,"defense":26906977,"professionXP":0,"dropRate":0},"requiredLevel":1,"description":"Une simple capuche en cuir."}}],"inventory":[{"id":"iron_helmet_1760376608858","name":"Casque de Fer","type":"armor","slot":"helmet","rarity":"uncommon","quality":"normal","qualityMultiplier":1,"locked":false,"icon":"🎩","stats":{"force":0,"agility":0,"intelligence":2,"wisdom":0,"endurance":5,"damage":0,"defense":8,"professionXP":0,"dropRate":0},"requiredLevel":4,"description":"Un casque protecteur en fer."},{"id":"iron_helmet_1760376609791","name":"Casque de Fer","type":"armor","slot":"helmet","rarity":"uncommon","quality":"normal","qualityMultiplier":1,"locked":false,"icon":"🎩","stats":{"force":0,"agility":0,"intelligence":2,"wisdom":0,"endurance":5,"damage":0,"defense":8,"professionXP":0,"dropRate":0},"requiredLevel":4,"description":"Un casque protecteur en fer."},{"id":"iron_helmet_1760376610491","name":"Casque de Fer","type":"armor","slot":"helmet","rarity":"uncommon","quality":"normal","qualityMultiplier":1,"locked":false,"icon":"🎩","stats":{"force":0,"agility":0,"intelligence":2,"wisdom":0,"endurance":5,"damage":0,"defense":8,"professionXP":0,"dropRate":0},"requiredLevel":4,"description":"Un casque protecteur en fer."},{"id":"iron_helmet_1760376611091","name":"Casque de Fer","type":"armor","slot":"helmet","rarity":"uncommon","quality":"normal","qualityMultiplier":1,"locked":false,"icon":"🎩","stats":{"force":0,"agility":0,"intelligence":2,"wisdom":0,"endurance":5,"damage":0,"defense":8,"professionXP":0,"dropRate":0},"requiredLevel":4,"description":"Un casque protecteur en fer."},{"id":"iron_helmet_1760376611642","name":"Casque de Fer","type":"armor","slot":"helmet","rarity":"uncommon","quality":"normal","qualityMultiplier":1,"locked":false,"icon":"🎩","stats":{"force":0,"agility":0,"intelligence":2,"wisdom":0,"endurance":5,"damage":0,"defense":8,"professionXP":0,"dropRate":0},"requiredLevel":4,"description":"Un casque protecteur en fer."},{"id":"iron_helmet_1760376612195","name":"Casque de Fer","type":"armor","slot":"helmet","rarity":"uncommon","quality":"superior","qualityMultiplier":1.2,"locked":false,"icon":"🎩","stats":{"force":0,"agility":0,"intelligence":2,"wisdom":0,"endurance":4770,"damage":0,"defense":8241,"professionXP":0,"dropRate":0},"requiredLevel":4,"description":"Un casque protecteur en fer."}]},"crafting":{"isCrafting":false,"currentCraft":null,"craftStartTime":0,"autoCraftState":{"enabled":false,"recipeId":null,"sellDirectly":true}},"buildings":{"buildings":[{"id":"sawmill","level":3},{"id":"mine","level":3},{"id":"warehouse","level":0},{"id":"treasury","level":0},{"id":"alchemy_lab","level":0}],"lastProductionTime":1760389572086},"alchemy":{"level":1,"xp":60,"unlocked":true,"conversionQueue":[]},"storage":{"limits":{"wood_oak":1000,"wood_ash":1000,"wood_maple":1000,"wood_birch":1000,"wood_walnut":1000,"wood_cedar":1000,"wood_yew":1000,"wood_elm":1000,"wood_sequoia":1000,"wood_bamboo":1000,"wood_ebony":1000,"wood_baobab":1000,"wood_moonwillow":1000,"wood_bloodwood":1000,"wood_ironwood":1000,"wood_spiritwood":1000,"wood_crystal":1000,"wood_shadow":1000,"wood_phoenix":1000,"wood_eternal":1000,"ore_iron":1000,"ore_copper":1000,"ore_tin":1000,"ore_bronze":1000,"ore_silver":1000,"ore_gold":1000,"ore_steel":1000,"ore_mithril":1000,"ore_obsidian":1000,"ore_platinum":1000,"ore_cobalt":1000,"ore_adamantite":1000,"ore_electrum":1000,"ore_runite":1000,"ore_orichalcum":1000,"ore_crystallium":1000,"ore_etherium":1000,"ore_draconium":1000,"ore_ombrium":1000,"ore_astralite":1000,"gem_quartz":1000,"gem_amethyst":1000,"gem_carnelian":1000,"gem_citrine":1000,"gem_onyx":1000,"gem_jade":1000,"gem_topaz":1000,"gem_garnet":1000,"gem_sapphire":1000,"gem_emerald":1000,"gem_ruby":1000,"gem_opal":1000,"gem_aquamarine":1000,"gem_spinel":1000,"gem_diamond":1000,"gem_tanzanite":1000,"gem_alexandrite":1000,"gem_voidstone":1000,"gem_dragoncrystal":1000,"gem_astraltears":1000,"loot_peau_animale":500,"loot_griffes_usees":500,"loot_plumes_sombres":500,"loot_cuir_robuste":500,"loot_crocs_venimeux":500,"loot_essence_vegetale_instable":500,"loot_os_massif":500,"loot_armure_cabossee":500,"loot_sang_concentre":500,"loot_corne_ancienne":500,"loot_cuir_legendaire":500,"loot_essence_vie_sauvage":500}},"ui":{"unlockedTabs":["home","combat","quests","gathering","equipment","crafting","town","dragons","alchemy","guild"]}}; // ← REMPLACEZ null par votre JSON copié !

// 3. Vérification et import
if (!saveData) {
    console.error('❌ ERREUR: Vous devez coller votre sauvegarde JSON à la ligne 23 !');
    console.log('📝 Instructions:');
    console.log('1. Ouvrez nylnato-save-2025-10-13T21-06-12.json');
    console.log('2. Copiez TOUT le contenu (Ctrl+A, Ctrl+C)');
    console.log('3. Remplacez "const saveData = null;" par "const saveData = <CTRL+V>;"');
    window.game.isResetting = false;
} else {
    console.log('📥 Sauvegarde chargée:', saveData.player.name, 'niveau', saveData.player.level);
    
    // Écrire dans localStorage
    localStorage.setItem('nylnatoIdleSave_v1', JSON.stringify(saveData));
    
    // Vérifier l'écriture
    const verification = JSON.parse(localStorage.getItem('nylnatoIdleSave_v1'));
    console.log('✅ ÉCRIT:', verification.player.name, 'niveau', verification.player.level, 'or', verification.player.resources.gold);
    
    // Recharger la page SANS sauvegarder (isResetting bloque beforeunload)
    console.log('🔄 Rechargement dans 2 secondes...');
    setTimeout(() => {
        location.reload();
    }, 2000);
}
